{{- if .Values.mcpConfig.enabled }}
# We quote everything, small adoption start of KYAML; also less prone to errors later
apiVersion: v1
kind: ConfigMap
metadata:
  name: teams-mcp-config
  labels:
    {{- include "chart.labels" . | nindent 4 }}
data:
  # App configuration
  SELF_URL: {{ .Values.mcpConfig.app.selfUrl | quote }}
  PORT: {{ .Values.mcpConfig.app.port | quote }}

  # Microsoft Graph configuration
  MICROSOFT_CLIENT_ID: {{ .Values.mcpConfig.microsoft.clientId | quote }}
  MICROSOFT_PUBLIC_WEBHOOK_URL: {{ .Values.mcpConfig.microsoft.publicWebhookUrl | quote }}

  # Unique API configuration
  UNIQUE_SERVICE_AUTH_MODE: {{ .Values.mcpConfig.unique.serviceAuthMode | quote }}
  UNIQUE_API_BASE_URL: {{ .Values.mcpConfig.unique.apiBaseUrl | quote }}
  UNIQUE_API_VERSION: {{ .Values.mcpConfig.unique.apiVersion | quote }}
  UNIQUE_ROOT_SCOPE_PATH: {{ .Values.mcpConfig.unique.rootScopePath | quote }}
  UNIQUE_USER_FETCH_CONCURRENCY: {{ .Values.mcpConfig.unique.userFetchConcurrency | quote }}
  # NOTE: UNIQUE_SERVICE_EXTRA_HEADERS is loaded from a secret via server.envVars (contains auth tokens)
  {{- if eq .Values.mcpConfig.unique.serviceAuthMode "cluster_local" }}
  UNIQUE_INGESTION_SERVICE_BASE_URL: {{ .Values.mcpConfig.unique.ingestionServiceBaseUrl | quote }}
  {{- end }}

  # Auth configuration
  AUTH_ACCESS_TOKEN_EXPIRES_IN_SECONDS: {{ .Values.mcpConfig.auth.accessTokenExpiresInSeconds | quote }}
  AUTH_REFRESH_TOKEN_EXPIRES_IN_SECONDS: {{ .Values.mcpConfig.auth.refreshTokenExpiresInSeconds | quote }}
{{- end }}
