{{- if .Values.connectorConfig.enabled }}
# We quote everything, small adoption start of KYAML; also less prone to errors later
apiVersion: v1
kind: ConfigMap
metadata:
  name: sharepoint-connector-config
  labels:
    {{- include "chart.labels" . | nindent 4 }}
data:
  # Sharepoint config
  SHAREPOINT_GRAPH_USE_OIDC_AUTH: {{ .Values.connectorConfig.sharepoint.graph.useOidcAuth | quote }}
  {{- if .Values.connectorConfig.sharepoint.graph.clientId | quote }}
  SHAREPOINT_GRAPH_CLIENT_ID: {{ .Values.connectorConfig.sharepoint.graph.clientId | quote }}
  {{- end }}
  SHAREPOINT_GRAPH_API_URL: {{ .Values.connectorConfig.sharepoint.graph.apiUrl | quote }}
  SHAREPOINT_GRAPH_TENANT_ID: {{ .Values.connectorConfig.sharepoint.graph.tenantId | quote }}
  {{- if .Values.connectorConfig.sharepoint.graph.rateLimitPer10Seconds | quote }}
  SHAREPOINT_GRAPH_RATE_LIMIT_PER_10_SECONDS: {{ .Values.connectorConfig.sharepoint.graph.rateLimitPer10Seconds | quote }}
  {{- end }}
  SHAREPOINT_BASE_URL: {{ .Values.connectorConfig.sharepoint.baseUrl | quote }}
  SHAREPOINT_SITE_IDS: {{ .Values.connectorConfig.sharepoint.siteIds | join "," | quote }}
  SHAREPOINT_SYNC_COLUMN_NAME: {{ .Values.connectorConfig.sharepoint.syncColumnName | quote }}
  # Unique config
  {{- if .Values.connectorConfig.unique.scopeId }}
  UNIQUE_SCOPE_ID: {{ .Values.connectorConfig.unique.scopeId | quote }}
  {{- end }}
  UNIQUE_FILE_DIFF_BASE_PATH: {{ .Values.connectorConfig.unique.fileDiffBasePath | quote }}
  UNIQUE_FILE_DIFF_URL: {{ .Values.connectorConfig.unique.fileDiffUrl | quote }}
  UNIQUE_INGESTION_GRAPHQL_URL: {{ .Values.connectorConfig.unique.ingestionGraphqlUrl | quote }}
  UNIQUE_ZITADEL_CLIENT_ID: {{ .Values.connectorConfig.unique.zitadel.clientId | quote }}
  UNIQUE_ZITADEL_OAUTH_TOKEN_URL: {{ .Values.connectorConfig.unique.zitadel.oauthTokenUrl | quote }}
  # Zitadel project ID is double quoted because env variables that are numbers outside of JS
  # precision cause problems. They are parsed as JSON values and precision problems alter the value.
  UNIQUE_ZITADEL_PROJECT_ID: {{ .Values.connectorConfig.unique.zitadel.projectId | quote | squote }}
  # Processing config
  PROCESSING_STEP_TIMEOUT_SECONDS: {{ .Values.connectorConfig.processing.stepTimeoutSeconds | quote }}
  PROCESSING_ALLOWED_MIME_TYPES: {{ .Values.connectorConfig.processing.allowedMimeTypes | join "," }}
  PROCESSING_CONCURRENCY: {{ .Values.connectorConfig.processing.concurrency | quote }}
  PROCESSING_MAX_FILES_TO_SCAN: {{ .Values.connectorConfig.processing.maxFilesToScan | quote }}
  {{- if .Values.connectorConfig.processing.maxFileSizeBytes }}
  PROCESSING_MAX_FILE_SIZE_BYTES: {{ .Values.connectorConfig.processing.maxFileSizeBytes | quote }}
  {{- end }}
{{- end }}
