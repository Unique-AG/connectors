connector:
  deployment:
    metadata:
      annotations:
        reloader.stakater.com/auto: "true"
  env:
    LOG_LEVEL: info
    LOGS_DIAGNOSTICS_DATA_POLICY: conceal
    MAX_FILE_SIZE_BYTES: "209715200"
    MAX_HEAP_MB: 1920
    NODE_ENV: production
    OTEL_EXPORTER_PROMETHEUS_HOST: "0.0.0.0"
    OTEL_EXPORTER_PROMETHEUS_PORT: "51346"
    OTEL_METRICS_EXPORTER: "prometheus"
    # Glob pattern to match tenant configuration YAML files
    TENANT_CONFIG_PATH_PATTERN: /app/tenant-configs/*-tenant-config.yaml
  # -- Environment variables from secrets.
  # Example for loading secrets (uncomment and customize as needed):
  #   envVars:
  #     # For Zitadel authentication (required when authMode is 'external')
  #     - name: ZITADEL_CLIENT_SECRET
  #       valueFrom:
  #         secretKeyRef:
  #           name: sharepoint-connector-secret
  #           key: ZITADEL_CLIENT_SECRET
  #     # For encrypted certificate private key (optional, only if key is password-protected)
  #     - name: SHAREPOINT_AUTH_PRIVATE_KEY_PASSWORD
  #       valueFrom:
  #         secretKeyRef:
  #           name: sharepoint-connector-secret
  #           key: SHAREPOINT_AUTH_PRIVATE_KEY_PASSWORD
  # See https://artifacthub.io/packages/helm/unique/backend-service?modal=values&path=envVars for more options.
  envVars: []
  image:
    repository: ghcr.io/unique-ag/connectors/services/sharepoint-connector
    tag: 2.0.0-beta.8 # x-release-please-version
  networkPolicy:
    enabled: true
    policyTypes:
      # - Egress # We can not yet leverage egress policies as Kubernetes flavor policies do not support FQDN and MS Graph IP-Addresses are not easily deterministic
      - Ingress
    egress: null
  ports:
    application: 51345
    metrics: 51346
  resources:
    # Resources are granted generously as the service for now is a singleton
    limits:
      memory: 2048Mi
    requests:
      cpu: 1
      memory: 1984Mi
  routes:
    paths:
      default:
        enabled: false
  service:
    enabled: false
  serviceAccount:
    enabled: true
    workloadIdentity:
      enabled: true
      clientId: unset_default_value
  # The volume is needed for CorePack afawct
  # FIXME: Correct @konsti?
  volumes:
    - name: tmp
      emptyDir: {}
      # -- Graph/SharePoint Certificate Secret
      # by default the chart expects the certificate to be in a secret named sharepoint-connector-secret under the key key.pem
      # Users can supersede this with their own secret that contains the certificate under a different key or use
      # Users must also set the connectorConfig.sharepoint.auth.privateKeyPath to the path of the certificate in the secret
    - name: sharepoint-connector-secret
      secret:
        secretName: sharepoint-connector-secret
        items:
          - key: key.pem
            path: key.pem
      # -- Tenant configuration YAML file mounted from ConfigMap
    - name: tenant-config
      configMap:
        name: sharepoint-connector-tenant-config
  volumeMounts:
    - name: tmp
      mountPath: /tmp
    - name: sharepoint-connector-secret
      mountPath: /app/key.pem
      subPath: key.pem
      readOnly: true
      # -- Mount tenant configuration directory
    - name: tenant-config
      mountPath: /app/tenant-configs
      readOnly: true

# -- Grafana dashboard configuration
grafana:
  dashboard:
    # -- Enable Grafana dashboard ConfigMap creation
    enabled: false
    # -- Grafana folder where the dashboard will be placed
    folder: connectors

# -- Prometheus alerting rules configuration
alerts:
  # -- Enable PrometheusRule resource creation
  enabled: false
  # -- Default alert definitions
  defaultAlerts:
    # -- Enable GraphQL API error rate alerts
    graphql:
      enabled: true
      # -- Disable specific alerts by setting them to true
      disabled: {}
        # SharepointConnectorGraphQLErrors: false
      # -- Override alert rules with custom values (for duration, severity, threshold, etc.)
      customRules: {}
        # SharepointConnectorGraphQLErrors:
        #   for: "15s"
        #   severity: "critical"
        #   threshold: 0.05
    # -- Enable Unique REST API error rate alerts
    uniqueApi:
      enabled: true
      # -- Disable specific alerts by setting them to true
      disabled: {}
        # SharepointConnectorUniqueAPIErrors: false
      # -- Override alert rules with custom values (for duration, severity, threshold, etc.)
      customRules: {}
        # SharepointConnectorUniqueAPIErrors:
        #   for: "15s"
        #   severity: "critical"
        #   threshold: 0.05
    # -- Enable sync failure alerts
    syncs:
      enabled: true
      # -- Disable specific alerts by setting them to true
      disabled: {}
        # SharepointConnectorSyncFailures: false
      # -- Override alert rules with custom values (for duration, severity, threshold, etc.)
      customRules: {}
        # SharepointConnectorSyncFailures:
        #   for: "15s"
        #   severity: "critical"
        #   threshold: 0.05
    # -- Additional labels to add to all default alerts
    additionalLabels: {}
      # environment: production
      # team: backend

# -- config for the deployed connector, will be mapped to the connectors environment variables
# users preferring setting all variables by hand disable the enabled flag and set the extraEnvCM to []
connectorConfig:
  # -- if disabled, connector.extraEnvCM must be set to []
  enabled: true
  sharepoint:
    # -- tenant id against which the graph api calls are made
    # example: 12345678-1234-1234-1234-123456789012
    tenantId: unset_default_value
    # -- base url of the sharepoint instance
    # example: https://acme.sharepoint.com
    baseUrl: unset_default_value
    auth:
      # -- authentication mode
      # possible values: certificate
      mode: certificate
      # -- Azure AD application client ID
      # example: 00000000-0000-0000-0000-000000000000
      # The matching certificate (private key file) must be sourced and mounted from a secret
      clientId: unset_default_value
      # -- path to the private key file of the Azure AD application certificate in PEM format
      # this closely relates to the volumeMounts and volume definitions in the connector section
      # users wanting to use another path can override this value and unset the volumeMounts and
      # volume definitions
      # if the key is encrypted, the password must be via a secret into a SHAREPOINT_AUTH_PRIVATE_KEY_PASSWORD environment variable
      privateKeyPath: /app/key.pem
      # -- SHA1 thumbprint of the Azure AD application certificate
      # users of the sharepoint-connector-secrets terraform module can get this from the modules outputs (thumbprint_sha1)
      # users that provision their application registration manually can get this from the Azure portal
      thumbprintSha1: ""
      # One of thumbprintSha1 or thumbprintSha256 must be provided
      thumbprintSha256: ""
    # -- Rate limiting for Graph API requests per minute (in thousands)
    apiRateLimitPerMinuteThousands: 780
    # -- Sites source configuration
    # Determines how sites are configured: from static YAML (config_file) or dynamically from SharePoint list (sharepoint_list)
    # possible values: config_file, sharepoint_list
    sitesSource: config_file
    # -- SharePoint list configuration (only used when sitesSource is "sharepoint_list")
    # siteId: SharePoint site ID containing the configuration list
    # listDisplayName: Display name of the SharePoint configuration list
    # sharepointList:
    #   siteId: 00000000-0000-0000-0000-000000000000
    #   listDisplayName: MyConfigurationList
    # -- Array of sites to sync. Each site has its own configuration.
    # Only used when sitesSource is "config_file"
    # sites:
    #   - siteId: 00000000-0000-0000-0000-000000000000
    #     syncColumnName: FinanceGPTKnowledge
    #     ingestionMode: recursive
    #     scopeId: scope_example123456789
    #     maxFilesToIngest: 1000
    #     storeInternally: enabled
    #     syncStatus: active
    #     syncMode: content_and_permissions
    #     # -- THIS CONFIG HAS EFFECT ONLY IN CONTENT_ONLY SYNC MODE: inheritance mode for scopes and files.
    #     # Allowed values: inherit_scopes_and_files, inherit_scopes, inherit_files, none.
    #     # When unset, defaults to inherit_scopes_and_files; ignored in content_and_permissions.
    #     permissionsInheritanceMode: inherit_scopes_and_files
      # Example: Additional site with different settings
      # - siteId: 00000000-0000-0000-0000-000000000001
      #   syncColumnName: HRKnowledge
      #   ingestionMode: flat
      #   scopeId: scope_bu4gokr0atzj0kfiubbbbbb
      #   maxFilesToIngest: 500
      #   storeInternally: enabled
      #   syncStatus: active
      #   syncMode: content_only
      #   permissionsInheritanceMode: inherit_scopes_and_files

  unique:
    # -- communication mode for the Unique Services
    # possible values: cluster_local, external
    # cluster_local: communicates using in-cluster URLs and requires serviceExtraHeaders with x-company-id and x-user-id
    # external: communicates using external URLs and requires authentication via Zitadel
    authMode: cluster_local
    # -- base URL for the ingestion service
    # example: https://api.unique.app/ingestion
    # example: http://node-ingestion.finance-gpt:8091
    ingestionServiceBaseUrl: unset_default_value
    # -- base URL for the scope management service
    # example: https://api.unique.app/scope-management
    # example: http://node-scope-management.finance-gpt:8094
    scopeManagementServiceBaseUrl: unset_default_value
    # -- Number of Unique API requests allowed per minute
    apiRateLimitPerMinute: 100
    # -- Object containing extra HTTP headers for Unique API requests (GraphQL and REST)
    # Required when authMode is cluster_local. Must contain x-company-id and x-user-id headers.
    # example: {"x-company-id": "1234567890", "x-user-id": "1234567890"}
    serviceExtraHeaders:
      x-company-id: unset_default_value
      x-user-id: unset_default_value
    # -- Optional object containing config to pass when submitting file for ingestion
    # ingestionConfig:
    #   uniqueIngestionMode: SKIP_INGESTION
    #   customProperty: value
    # -- Zitadel authentication configuration (required when authMode is external)
    zitadel:
      # -- Zitadel client ID
      clientId: unset_default_value
      # -- Zitadel OAuth token URL
      # example: https://idp.unique.app/oauth/v2/token
      oauthTokenUrl: unset_default_value
      # -- Zitadel project ID
      # example: 225317577440629999
      projectId: unset_default_value
      # clientSecret is loaded from a secret, see connector.envVars

  processing:
    # -- timeout in seconds for a file processing step before it will stop and skip processing the file
    stepTimeoutSeconds: 300
    # -- how many files you want to submit for ingestion into Unique at once
    concurrency: 1
    # -- list of allowed MIME types for files to sync
    allowedMimeTypes:
      - application/pdf
      - text/plain
      - text/html
      - application/x-asp
      - application/vnd.openxmlformats-officedocument.wordprocessingml.document
      - application/vnd.ms-excel
      - application/vnd.openxmlformats-officedocument.spreadsheetml.sheet
      - application/vnd.openxmlformats-officedocument.presentationml.presentation
    maxFileSizeToIngestBytes: null
    # -- cron expression for the scheduled SharePoint scan interval default: every 15 minutes
    scanIntervalCron: "*/15 * * * *"
