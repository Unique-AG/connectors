{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "connector": {
      "type": "object",
      "description": "Configuration for the backend-service dependency",
      "properties": {
        "env": {
          "type": "object",
          "description": "Environment variables for the connector",
          "properties": {
            "LOGS_DIAGNOSTICS_DATA_POLICY": {
              "type": "string",
              "enum": [
                "conceal",
                "disclose"
              ],
              "description": "Controls whether sensitive data like site names and IDs are logged in full or redacted",
              "default": "conceal"
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "grafana": {
      "type": "object",
      "description": "Grafana dashboard configuration",
      "properties": {
        "dashboard": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Grafana dashboard creation"
            },
            "folder": {
              "type": "string",
              "description": "Grafana folder name for the dashboard"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "alerts": {
      "type": "object",
      "description": "Prometheus alerting rules configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable Prometheus alerting rules",
          "default": false
        },
        "defaultAlerts": {
          "type": "object",
          "description": "Default alert configurations",
          "properties": {
            "graphql": {
              "type": "object",
              "description": "Configuration for GraphQL API error alerts",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable GraphQL API error rate alerts",
                  "default": true
                },
                "disabled": {
                  "type": "object",
                  "description": "Disable specific alerts by setting them to true",
                  "properties": {
                    "SharepointConnectorGraphQLErrors": {
                      "type": "boolean",
                      "description": "Disable the SharepointConnectorGraphQLErrors alert"
                    }
                  },
                  "additionalProperties": false
                },
                "customRules": {
                  "type": "object",
                  "description": "Override alert rules with custom values",
                  "properties": {
                    "SharepointConnectorGraphQLErrors": {
                      "type": "object",
                      "description": "Custom configuration for SharepointConnectorGraphQLErrors alert",
                      "properties": {
                        "threshold": {
                          "type": "number",
                          "description": "Error rate threshold (0.01 = 1% error rate)",
                          "default": 0.01
                        },
                        "for": {
                          "type": "string",
                          "description": "Duration the condition must be true before firing",
                          "default": "30s"
                        },
                        "severity": {
                          "type": "string",
                          "enum": [
                            "critical",
                            "warning",
                            "info"
                          ],
                          "description": "Alert severity",
                          "default": "warning"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "uniqueApi": {
              "type": "object",
              "description": "Configuration for Unique REST API error alerts",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable Unique REST API error rate alerts",
                  "default": true
                },
                "disabled": {
                  "type": "object",
                  "description": "Disable specific alerts by setting them to true",
                  "properties": {
                    "SharepointConnectorUniqueAPIErrors": {
                      "type": "boolean",
                      "description": "Disable the SharepointConnectorUniqueAPIErrors alert"
                    }
                  },
                  "additionalProperties": false
                },
                "customRules": {
                  "type": "object",
                  "description": "Override alert rules with custom values",
                  "properties": {
                    "SharepointConnectorUniqueAPIErrors": {
                      "type": "object",
                      "description": "Custom configuration for SharepointConnectorUniqueAPIErrors alert",
                      "properties": {
                        "threshold": {
                          "type": "number",
                          "description": "Error rate threshold (0.01 = 1% error rate)",
                          "default": 0.01
                        },
                        "for": {
                          "type": "string",
                          "description": "Duration the condition must be true before firing",
                          "default": "30s"
                        },
                        "severity": {
                          "type": "string",
                          "enum": [
                            "critical",
                            "warning",
                            "info"
                          ],
                          "description": "Alert severity",
                          "default": "warning"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "syncs": {
              "type": "object",
              "description": "Configuration for sync failure alerts",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable sync failure alerts",
                  "default": true
                },
                "disabled": {
                  "type": "object",
                  "description": "Disable specific alerts by setting them to true",
                  "properties": {
                    "SharepointConnectorSyncFailures": {
                      "type": "boolean",
                      "description": "Disable the SharepointConnectorSyncFailures alert"
                    }
                  },
                  "additionalProperties": false
                },
                "customRules": {
                  "type": "object",
                  "description": "Override alert rules with custom values",
                  "properties": {
                    "SharepointConnectorSyncFailures": {
                      "type": "object",
                      "description": "Custom configuration for SharepointConnectorSyncFailures alert",
                      "properties": {
                        "threshold": {
                          "type": "number",
                          "description": "Failure count threshold",
                          "default": 0.01
                        },
                        "for": {
                          "type": "string",
                          "description": "Duration the condition must be true before firing",
                          "default": "30s"
                        },
                        "severity": {
                          "type": "string",
                          "enum": [
                            "critical",
                            "warning",
                            "info"
                          ],
                          "description": "Alert severity",
                          "default": "warning"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "additionalLabels": {
              "type": "object",
              "description": "Additional labels to add to all alerts and the PrometheusRule"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "connectorConfig": {
      "type": "object",
      "description": "SharePoint connector configuration",
      "required": [
        "enabled",
        "sharepoint",
        "unique",
        "processing"
      ],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Wether to use the connector config."
        },
        "sharepoint": {
          "type": "object",
          "description": "SharePoint configuration",
          "required": [
            "tenantId",
            "baseUrl",
            "sites",
            "auth",
            "graph"
          ],
          "properties": {
            "tenantId": {
              "type": "string",
              "description": "Azure AD tenant ID against which the Graph API calls are made",
              "examples": [
                "00000000-0000-0000-0000-000000000000"
              ]
            },
            "baseUrl": {
              "type": "string",
              "description": "SharePoint base URL",
              "examples": [
                "https://contoso.sharepoint.com",
                "https://my-company.sharepoint.com"
              ]
            },
            "sites": {
              "type": "array",
              "description": "Array of SharePoint sites to sync with their individual configurations",
              "minItems": 1,
              "items": {
                "type": "object",
                "required": [
                  "siteId",
                  "syncColumnName",
                  "ingestionMode",
                  "scopeId",
                  "storeInternally",
                  "syncStatus",
                  "syncMode"
                ],
                "properties": {
                  "siteId": {
                    "type": "string",
                    "description": "SharePoint site ID (UUID)",
                    "examples": [
                      "00000000-0000-0000-0000-000000000000"
                    ]
                  },
                  "syncColumnName": {
                    "type": "string",
                    "description": "Column name for synchronization in this site",
                    "examples": [
                      "FinanceGPTKnowledge",
                      "HRKnowledge"
                    ]
                  },
                  "ingestionMode": {
                    "type": "string",
                    "enum": [
                      "flat",
                      "recursive"
                    ],
                    "description": "Ingestion mode for this site: flat ingests all files to a single root scope, recursive maintains the folder hierarchy"
                  },
                  "scopeId": {
                    "type": "string",
                    "description": "Scope ID to be used as root for ingestion for this site",
                    "examples": [
                      "scope_bu4gokr0atzj0kfiuaaaaaaa"
                    ]
                  },
                  "maxFilesToIngest": {
                    "type": "integer",
                    "minimum": 1,
                    "description": "Maximum number of files to ingest for this site in a single run"
                  },
                  "storeInternally": {
                    "type": "string",
                    "enum": [
                      "enabled",
                      "disabled"
                    ],
                    "description": "Whether to store content internally in Unique for this site"
                  },
                  "syncStatus": {
                    "type": "string",
                    "enum": [
                      "active",
                      "inactive",
                      "deleted"
                    ],
                    "description": "Sync status: active = sync normally, inactive = skip, deleted = delete scope recursively"
                  },
                  "syncMode": {
                    "type": "string",
                    "enum": [
                      "content_only",
                      "content_and_permissions"
                    ],
                    "description": "Mode of synchronization for this site"
                  }
                },
                "additionalProperties": false
              }
            },
            "auth": {
              "type": "object",
              "description": "SharePoint authentication configuration",
              "required": [
                "mode",
                "clientId",
                "privateKeyPath",
                "thumbprintSha1"
              ],
              "properties": {
                "mode": {
                  "type": "string",
                  "description": "Authentication mode",
                  "enum": [
                    "certificate"
                  ]
                },
                "clientId": {
                  "type": "string",
                  "description": "Azure AD application client ID",
                  "examples": [
                    "00000000-0000-0000-0000-000000000000"
                  ]
                },
                "clientSecret": {
                  "type": [
                    "string",
                    "null"
                  ],
                  "description": "Azure AD application client secret"
                },
                "privateKeyPath": {
                  "type": "string",
                  "description": "Path to the private key file of the Azure AD application certificate in PEM format",
                  "examples": [
                    "/app/key.pem",
                    "/my/custom/mount/path/key.pem"
                  ]
                },
                "thumbprintSha1": {
                  "type": "string",
                  "description": "SHA1 thumbprint of the Azure AD application certificate",
                  "examples": [
                    "2fd4e1c67a2d28fced849ee1bb76e7391b93eb12"
                  ]
                }
              },
              "additionalProperties": false
            },
            "graph": {
              "type": "object",
              "description": "Microsoft Graph API configuration",
              "required": [],
              "properties": {
                "apiRateLimitPerMinute": {
                  "type": "integer",
                  "description": "Rate limiting for Graph API requests per minute"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "unique": {
          "type": "object",
          "description": "Unique platform configuration",
          "required": [
            "ingestionServiceBaseUrl",
            "scopeManagementServiceBaseUrl",
            "authMode"
          ],
          "properties": {
            "ingestionServiceBaseUrl": {
              "type": "string",
              "description": "Base URL for the ingestion service",
              "examples": [
                "http://node-ingestion.finance-gpt:8091",
                "https://api.unique.app/ingestion"
              ]
            },
            "scopeManagementServiceBaseUrl": {
              "type": "string",
              "description": "Base URL for the scope management service",
              "examples": [
                "http://node-scope-management.finance-gpt:8094",
                "https://api.unique.app/scope-management"
              ]
            },
            "apiRateLimitPerMinute": {
              "type": "integer",
              "description": "Number of Unique API requests allowed per minute"
            },
            "authMode": {
              "type": "string",
              "enum": [
                "cluster_local",
                "external"
              ],
              "description": "Communication mode for the Unique Services. cluster_local: communicates using in-cluster URLs and requires serviceExtraHeaders with x-company-id and x-user-id. external: communicates using external URLs and requires authentication via Zitadel."
            },
            "serviceExtraHeaders": {
              "type": "object",
              "description": "HTTP extra headers for ingestion API requests. Required when authMode is cluster_local. Must contain x-company-id and x-user-id headers.",
              "examples": [
                {
                  "x-company-id": "123456789101112131",
                  "x-user-id": "123456789101112131"
                }
              ]
            },
            "ingestionConfig": {
              "type": "object",
              "description": "JSON string of config to pass when submitting file for ingestion",
              "examples": [
                {
                  "uniqueIngestionMode": "INGESTION",
                  "customProperty": "value"
                }
              ]
            },
            "zitadel": {
              "type": "object",
              "description": "Zitadel authentication configuration (required when authMode is external)",
              "required": [
                "clientId",
                "oauthTokenUrl",
                "projectId"
              ],
              "properties": {
                "clientId": {
                  "type": "string",
                  "description": "Zitadel client ID",
                  "examples": [
                    "sharepoint-connector@idp.unique.app"
                  ]
                },
                "oauthTokenUrl": {
                  "type": "string",
                  "description": "Zitadel OAuth token URL",
                  "examples": [
                    "https://idp.unique.app/oauth/v2/token"
                  ]
                },
                "projectId": {
                  "type": "string",
                  "description": "Zitadel project ID",
                  "examples": [
                    "123456789101112131"
                  ]
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        },
        "processing": {
          "type": "object",
          "description": "Files processing configuration",
          "required": [
            "allowedMimeTypes",
            "concurrency"
          ],
          "properties": {
            "allowedMimeTypes": {
              "type": "array",
              "items": {
                "type": "string",
                "examples": [
                  "application/pdf",
                  "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                ]
              },
              "description": "List of allowed MIME types for file processing",
              "examples": [
                [
                  "application/pdf",
                  "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
                ]
              ]
            },
            "concurrency": {
              "type": "integer",
              "description": "Number of concurrent processing operations"
            },
            "stepTimeoutSeconds": {
              "type": "integer",
              "description": "Timeout in seconds for processing steps"
            },
            "maxFileSizeToIngestBytes": {
              "type": [
                "integer",
                "null"
              ],
              "description": "Maximum file size in bytes to ingest"
            },
            "scanIntervalCron": {
              "type": "string",
              "description": "Cron expression for the scheduled SharePoint scan interval",
              "examples": [
                "*/15 * * * *"
              ]
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}