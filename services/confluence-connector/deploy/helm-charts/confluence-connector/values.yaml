connector:
  deployment:
    metadata:
      annotations:
        reloader.stakater.com/auto: "true"
  env:
    LOG_LEVEL: info
    LOGS_DIAGNOSTICS_DATA_POLICY: conceal
    MAX_FILE_SIZE_BYTES: "209715200"
    MAX_HEAP_MB: 896
    NODE_ENV: production
    OTEL_EXPORTER_PROMETHEUS_HOST: "0.0.0.0"
    OTEL_EXPORTER_PROMETHEUS_PORT: "51350"
    OTEL_METRICS_EXPORTER: "prometheus"
    # Glob pattern to match tenant configuration YAML files
    TENANT_CONFIG_PATH_PATTERN: /app/tenant-configs/*-tenant-config.yaml
  # -- Environment variables from secrets.
  # Example for loading secrets (uncomment and customize as needed):
  #   envVars:
  #     # For Zitadel authentication (required when authMode is 'external')
  #     - name: ZITADEL_CLIENT_SECRET
  #       valueFrom:
  #         secretKeyRef:
  #           name: confluence-connector-secret
  #           key: ZITADEL_CLIENT_SECRET
  #     # For Confluence OAuth 2.0 (2LO) client secret
  #     - name: CONFLUENCE_CLIENT_SECRET
  #       valueFrom:
  #         secretKeyRef:
  #           name: confluence-connector-secret
  #           key: CONFLUENCE_CLIENT_SECRET
  # See https://artifacthub.io/packages/helm/unique/backend-service?modal=values&path=envVars for more options.
  envVars: []
  # -- List of ConfigMaps to load as environment variables
  extraEnvCM: []
  image:
    repository: ghcr.io/unique-ag/connectors/services/confluence-connector
    tag: 2.0.0-alpha.0 # x-release-please-version
  ports:
    application: 51349
    metrics: 51350
  resources:
    limits:
      memory: 1024Mi
    requests:
      cpu: 500m
      memory: 960Mi
  routes:
    paths:
      default:
        enabled: false
  service:
    enabled: false
  serviceAccount:
    enabled: true
  volumes:
    - name: tmp
      emptyDir: {}
    # -- Tenant configuration YAML file mounted from ConfigMap
    - name: tenant-config
      configMap:
        name: confluence-connector-tenant-config
  volumeMounts:
    - name: tmp
      mountPath: /tmp
    # -- Mount tenant configuration directory
    - name: tenant-config
      mountPath: /app/tenant-configs
      readOnly: true

# -- Grafana dashboard configuration
grafana:
  dashboard:
    # -- Enable Grafana dashboard ConfigMap creation
    enabled: false
    # -- Grafana folder where the dashboard will be placed
    folder: connectors

# -- Prometheus alerting rules configuration
alerts:
  # -- Enable PrometheusRule resource creation
  enabled: false
  # -- Default alert definitions
  defaultAlerts:
    # -- Enable Unique REST API error rate alerts
    uniqueApi:
      enabled: true
      # -- Disable specific alerts by setting them to true
      disabled: {}
        # ConfluenceConnectorUniqueAPIErrors: false
      # -- Override alert rules with custom values (for duration, severity, threshold, etc.)
      customRules: {}
        # ConfluenceConnectorUniqueAPIErrors:
        #   for: "15s"
        #   severity: "critical"
        #   threshold: 0.05
    # -- Additional labels to add to all default alerts
    additionalLabels: {}
      # environment: production
      # team: backend

connectorConfig:
  # -- if disabled, tenant-config must be removed from the connector.volumes and
  # connector.volumeMounts
  enabled: true
  tenants:
    - name: default
      confluence:
        # -- Confluence instance type: cloud or data-center
        instanceType: cloud
        # -- base url of the Confluence instance
        # example (cloud): https://acme.atlassian.net/wiki
        # example (data-center): https://confluence.acme.com
        baseUrl: unset_default_value
        auth:
          # -- authentication mode
          # possible values: oauth_2lo
          mode: oauth_2lo
          # -- OAuth 2.0 (2LO) application client ID
          clientId: unset_default_value
          # clientSecret is loaded from a secret, see connector.envVars
        # -- Number of Confluence API requests allowed per minute
        apiRateLimitPerMinute: 100
        # -- Label to trigger single-page sync
        ingestSingleLabel: ai-ingest
        # -- Label to trigger full sync of all labeled pages
        ingestAllLabel: ai-ingest-all
        # -- Labels to filter content for ingestion
        # labels:
        #   - "unique-ingest"
        #   - "knowledge-base"
        # -- Space keys to sync (if empty, syncs all accessible spaces)
        # spaces:
        #   - "ENGINEERING"
        #   - "PRODUCT"

      unique:
        # -- communication mode for the Unique Services
        # possible values: cluster_local, external
        # cluster_local: communicates using in-cluster URLs and requires serviceExtraHeaders with x-company-id and x-user-id
        # external: communicates using external URLs and requires authentication via Zitadel
        authMode: cluster_local
        # -- base URL for the ingestion service
        # example: https://api.unique.app/ingestion
        # example: http://node-ingestion.finance-gpt:8091
        ingestionServiceBaseUrl: unset_default_value
        # -- base URL for the scope management service
        # example: https://api.unique.app/scope-management
        # example: http://node-scope-management.finance-gpt:8094
        scopeManagementServiceBaseUrl: unset_default_value
        # -- Number of Unique API requests allowed per minute
        apiRateLimitPerMinute: 100
        # -- Object containing extra HTTP headers for Unique API requests (GraphQL and REST)
        # Required when authMode is cluster_local. Must contain x-company-id and x-user-id headers.
        # example: {"x-company-id": "1234567890", "x-user-id": "1234567890"}
        serviceExtraHeaders:
          x-company-id: unset_default_value
          x-user-id: unset_default_value
        # -- Optional object containing config to pass when submitting file for ingestion
        # ingestionConfig:
        #   uniqueIngestionMode: SKIP_INGESTION
        #   customProperty: value
        # -- Zitadel authentication configuration (required when authMode is external)
        zitadel:
          # -- Zitadel client ID
          clientId: unset_default_value
          # -- Zitadel OAuth token URL
          # example: https://idp.unique.app/oauth/v2/token
          oauthTokenUrl: unset_default_value
          # -- Zitadel project ID
          # example: 225317577440629999
          projectId: unset_default_value
          # clientSecret is loaded from a secret, see connector.envVars

      processing:
        # -- timeout in seconds for a page processing step before it will stop and skip processing the page
        stepTimeoutSeconds: 300
        # -- how many pages you want to submit for ingestion into Unique at once
        concurrency: 1
        # -- cron expression for the scheduled Confluence scan interval default: every 15 minutes
        scanIntervalCron: "*/15 * * * *"
        # -- maximum number of pages to scan per run (null/empty for unlimited, useful for testing)
        # maxPagesToScan: 100
