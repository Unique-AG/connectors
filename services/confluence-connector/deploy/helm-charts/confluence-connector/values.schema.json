{
  "$schema": "https://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "connector": {
      "type": "object",
      "description": "Configuration for the backend-service dependency",
      "properties": {
        "env": {
          "type": "object",
          "description": "Environment variables for the connector",
          "properties": {
            "LOGS_DIAGNOSTICS_DATA_POLICY": {
              "type": "string",
              "enum": ["conceal", "disclose"],
              "description": "Controls whether sensitive data like space names and IDs are logged in full or redacted",
              "default": "conceal"
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "grafana": {
      "type": "object",
      "description": "Grafana dashboard configuration",
      "properties": {
        "dashboard": {
          "type": "object",
          "properties": {
            "enabled": {
              "type": "boolean",
              "description": "Enable Grafana dashboard creation"
            },
            "folder": {
              "type": "string",
              "description": "Grafana folder name for the dashboard"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "alerts": {
      "type": "object",
      "description": "Prometheus alerting rules configuration",
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable Prometheus alerting rules",
          "default": false
        },
        "defaultAlerts": {
          "type": "object",
          "description": "Default alert configurations",
          "properties": {
            "uniqueApi": {
              "type": "object",
              "description": "Configuration for Unique REST API error alerts",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "description": "Enable Unique REST API error rate alerts",
                  "default": true
                },
                "disabled": {
                  "type": "object",
                  "description": "Disable specific alerts by setting them to true",
                  "properties": {
                    "ConfluenceConnectorUniqueAPIErrors": {
                      "type": "boolean",
                      "description": "Disable the ConfluenceConnectorUniqueAPIErrors alert"
                    }
                  },
                  "additionalProperties": false
                },
                "customRules": {
                  "type": "object",
                  "description": "Override alert rules with custom values",
                  "properties": {
                    "ConfluenceConnectorUniqueAPIErrors": {
                      "type": "object",
                      "description": "Custom configuration for ConfluenceConnectorUniqueAPIErrors alert",
                      "properties": {
                        "threshold": {
                          "type": "number",
                          "description": "Error rate threshold (0.01 = 1% error rate)",
                          "default": 0.01
                        },
                        "for": {
                          "type": "string",
                          "description": "Duration the condition must be true before firing",
                          "default": "30s"
                        },
                        "severity": {
                          "type": "string",
                          "enum": ["critical", "warning", "info"],
                          "description": "Alert severity",
                          "default": "warning"
                        }
                      },
                      "additionalProperties": false
                    }
                  },
                  "additionalProperties": false
                }
              },
              "additionalProperties": false
            },
            "additionalLabels": {
              "type": "object",
              "description": "Additional labels to add to all alerts and the PrometheusRule"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "connectorConfig": {
      "type": "object",
      "description": "Confluence connector configuration",
      "required": ["enabled", "tenants"],
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether to use the connector config."
        },
        "tenants": {
          "type": "array",
          "description": "List of tenant configurations",
          "items": {
            "type": "object",
            "required": ["name", "confluence", "unique", "processing", "ingestion"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Tenant name used as identifier and config file prefix"
              },
              "confluence": {
                "type": "object",
                "description": "Confluence configuration",
                "required": [
                  "instanceType",
                  "baseUrl",
                  "auth",
                  "apiRateLimitPerMinute",
                  "ingestSingleLabel",
                  "ingestAllLabel"
                ],
                "properties": {
                  "instanceType": {
                    "type": "string",
                    "enum": ["cloud", "data-center"],
                    "description": "Confluence instance type: cloud or data-center"
                  },
                  "cloudId": {
                    "type": "string",
                    "description": "Atlassian Cloud ID (UUID) for the Confluence site. Required when instanceType is cloud."
                  },
                  "baseUrl": {
                    "type": "string",
                    "description": "Confluence base URL",
                    "examples": ["https://acme.atlassian.net", "https://confluence.acme.com"]
                  },
                  "auth": {
                    "type": "object",
                    "description": "Confluence authentication configuration",
                    "required": ["mode"],
                    "oneOf": [
                      {
                        "properties": {
                          "mode": {
                            "type": "string",
                            "enum": ["oauth_2lo"],
                            "description": "OAuth 2.0 two-legged (client credentials)"
                          },
                          "clientId": {
                            "type": "string",
                            "description": "OAuth 2.0 (2LO) application client ID"
                          }
                        },
                        "required": ["mode", "clientId"],
                        "additionalProperties": false
                      },
                      {
                        "properties": {
                          "mode": {
                            "type": "string",
                            "enum": ["pat"],
                            "description": "Personal Access Token (Data Center only)"
                          }
                        },
                        "required": ["mode"],
                        "additionalProperties": false
                      }
                    ]
                  },
                  "apiRateLimitPerMinute": {
                    "type": "integer",
                    "description": "Number of Confluence API requests allowed per minute"
                  },
                  "ingestSingleLabel": {
                    "type": "string",
                    "description": "Label to trigger single-page sync"
                  },
                  "ingestAllLabel": {
                    "type": "string",
                    "description": "Label to trigger full sync of all labeled pages"
                  }
                },
                "allOf": [
                  {
                    "if": {
                      "properties": {
                        "auth": {
                          "type": "object",
                          "required": ["mode"],
                          "properties": {
                            "mode": {
                              "const": "pat"
                            }
                          }
                        }
                      }
                    },
                    "then": {
                      "properties": {
                        "instanceType": {
                          "const": "data-center"
                        }
                      }
                    }
                  },
                  {
                    "if": {
                      "properties": {
                        "instanceType": {
                          "const": "cloud"
                        }
                      }
                    },
                    "then": {
                      "required": ["cloudId"]
                    }
                  }
                ],
                "additionalProperties": false
              },
              "unique": {
                "type": "object",
                "description": "Unique platform configuration",
                "required": [
                  "ingestionServiceBaseUrl",
                  "scopeManagementServiceBaseUrl",
                  "authMode",
                  "apiRateLimitPerMinute"
                ],
                "properties": {
                  "ingestionServiceBaseUrl": {
                    "type": "string",
                    "description": "Base URL for the ingestion service",
                    "examples": [
                      "http://node-ingestion.finance-gpt:8091",
                      "https://api.unique.app/ingestion"
                    ]
                  },
                  "scopeManagementServiceBaseUrl": {
                    "type": "string",
                    "description": "Base URL for the scope management service",
                    "examples": [
                      "http://node-scope-management.finance-gpt:8094",
                      "https://api.unique.app/scope-management"
                    ]
                  },
                  "apiRateLimitPerMinute": {
                    "type": "integer",
                    "description": "Number of Unique API requests allowed per minute"
                  },
                  "authMode": {
                    "type": "string",
                    "enum": ["cluster_local", "external"],
                    "description": "Communication mode for the Unique Services. cluster_local: communicates using in-cluster URLs and requires serviceExtraHeaders with x-company-id and x-user-id. external: communicates using external URLs and requires authentication via Zitadel."
                  },
                  "serviceExtraHeaders": {
                    "type": "object",
                    "description": "HTTP extra headers for ingestion API requests. Required when authMode is cluster_local. Must contain x-company-id and x-user-id headers.",
                    "examples": [
                      {
                        "x-company-id": "123456789101112131",
                        "x-user-id": "123456789101112131"
                      }
                    ]
                  },
                  "ingestionConfig": {
                    "type": "object",
                    "description": "Config object to pass when submitting content for ingestion",
                    "examples": [
                      {
                        "uniqueIngestionMode": "INGESTION",
                        "customProperty": "value"
                      }
                    ]
                  },
                  "zitadel": {
                    "type": "object",
                    "description": "Zitadel authentication configuration (required when authMode is external)",
                    "required": ["clientId", "oauthTokenUrl", "projectId"],
                    "properties": {
                      "clientId": {
                        "type": "string",
                        "description": "Zitadel client ID",
                        "examples": ["confluence-connector@idp.unique.app"]
                      },
                      "oauthTokenUrl": {
                        "type": "string",
                        "description": "Zitadel OAuth token URL",
                        "examples": ["https://idp.unique.app/oauth/v2/token"]
                      },
                      "projectId": {
                        "type": "string",
                        "description": "Zitadel project ID",
                        "examples": ["123456789101112131"]
                      }
                    },
                    "additionalProperties": false
                  }
                },
                "additionalProperties": false
              },
              "processing": {
                "type": "object",
                "description": "Page processing configuration",
                "properties": {
                  "stepTimeoutSeconds": {
                    "type": "integer",
                    "description": "Timeout in seconds for page processing steps"
                  },
                  "concurrency": {
                    "type": "integer",
                    "description": "Number of concurrent page processing operations"
                  },
                  "scanIntervalCron": {
                    "type": "string",
                    "description": "Cron expression for the scheduled page scan interval",
                    "examples": ["*/15 * * * *"]
                  },
                  "maxPagesToScan": {
                    "type": ["integer", "null"],
                    "description": "Maximum number of pages to scan (for testing). Unlimited if not set"
                  }
                },
                "additionalProperties": false
              },
              "ingestion": {
                "type": "object",
                "description": "Ingestion configuration",
                "required": ["ingestionMode", "scopeId"],
                "properties": {
                  "ingestionMode": {
                    "type": "string",
                    "enum": ["flat"],
                    "description": "Ingestion traversal mode"
                  },
                  "scopeId": {
                    "type": "string",
                    "description": "Root scope ID for ingestion"
                  }
                },
                "additionalProperties": false
              }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
